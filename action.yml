name: Gcovr Action
description: Generate code coverage report for C++ project using gcovr
author: Alfi Maulana
inputs:
  root:
    description: 'The root directory of your source files'
    required: false
  gcov-executable:
    description: 'Use a particular gcov executable'
    required: false
  exclude:
    description: 'Exclude source files that match this filter'
    required: false
  fail-under-line:
    description: 'Exit with a status of 2 if the total line coverage is less than this value'
    required: false
branding:
  color: green
  icon: terminal
runs:
  using: composite
  steps:
    - name: Check if gcovr is installed
      shell: bash
      run: |
        if ! command -v gcovr &> /dev/null; then
          echo "gcovr could not be found, installing..."
          pip install gcovr
        fi

    - name: Generate code coverage report using gcovr
      shell: bash
      run: |
        root="${{ inputs.root }}"
        gcov_exec="${{ inputs.gcov-executable }}"
        exclude="${{ inputs.exclude }}"
        fail_ul="${{ inputs.fail-under-line }}"
        gcovr \
          ${root:+ --root "$root"} \
          ${gcov_exec:+ --gcov-executable "$gcov_exec"} \
          ${exclude:+ --exclude "$exclude"} \
          ${fail_ul:+ --fail-under-line "$fail_ul"}
